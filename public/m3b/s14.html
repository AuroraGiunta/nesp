<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Web Storage API</title>
</head>

<body>
    <h1>Web Storage API</h1>
    <p>
        Back <a href=".">home</a>
    </p>

    <textarea id="target" rows="20" cols="120"></textarea>

    <h2>Web storage</h2>
    <div>
        <label><input type="radio" id="local" name="storage" checked>Local</label>
        <label><input type="radio" name="storage">Session</label>

        <button onclick="getAllItems()">Get all</button>
        <button onclick="clearStorage()">Clear</button>
        <button onclick="setItem()">Set</button><input id="set" value="user"><input id="value" value="bob">
        <button onclick="removeItem()">Remove</button><input id="del" value="user">
        <br><strong>Message to Bob: </strong><input id="msg" value="hello">
        <button onclick="setMessage()">Set</button>
    </div>

    <script type="text/javascript">
        const APP_NAME = 'nesp';

        function selectedStorage() {
            return document.getElementById("local").checked ? localStorage : sessionStorage;
        }

        function clearStorage() {
            selectedStorage().clear();
        }

        function getAllItems() {
            let storage = selectedStorage();
            let target = document.getElementById('target');
            target.value += 'Number of items currently in selected storage: ' + storage.length + '\n';
            for (let i = 0; i < storage.length; i++) {
                let key = storage.key(i);
                target.value += key + ' -> ' + storage.getItem(key) + '\n';
            }
        }

        function setItem() {
            let key = APP_NAME + '.' + document.getElementById('set').value;
            let value = document.getElementById('value').value;
            console.log('set', key, value);
            selectedStorage().setItem(key, value);
        }

        function removeItem() {
            let key = APP_NAME + '.' + document.getElementById('del').value;
            console.log('remove', key);
            selectedStorage().removeItem(key);
        }
        
        function setMessage() {
            let key = APP_NAME + '.message';
            let obj = {
                recipient: "Bob",
                msg: document.getElementById('msg').value
            };

            console.log('set', key, obj);
            selectedStorage().setItem(key, JSON.stringify({
                recipient: "Bob",
                msg: document.getElementById('msg').value
            }));
        }
    </script>
</body>

</html>